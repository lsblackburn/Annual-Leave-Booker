{% extends "layouts/app.html" %}

{% block head %}
<title>Dashboard</title>
{% endblock %}

{% block body %}

<div class="block mb-8">
    <h1 class="text-4xl font-bold text-gray-800">Dashboard</h1>
    <p class="text-gray-600">Here you can view all upcoming approved annual leave</p>
</div>

<a id="createLeave" href="{{ url_for('leave.create_leave') }}" class="purple_btn block hover:underline">Request
    Leave</a> <!-- Button for the user to book annual leave -->

<div class="shadow-md sm:rounded-lg mt-4">

    <div class="overflow-x-auto">

        <table class="w-full min-w-[600px] divide-y divide-gray-200 rounded-2xl shadow-md bg-white">
            <thead class="bg-gray-100 text-gray-700 text-sm uppercase tracking-wider">
                <tr>
                    <th class="px-4 py-3 text-left">Name</th>
                    <th class="px-4 py-3 text-left">Duration</th>
                    <th class="px-4 py-3 text-left">Status</th>
                    <th class="px-4 py-3 text-left">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 text-gray-700 text-sm">
                {% for leave in leaves %}
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-4 py-3">
                        <p>{{ leave.user.name }}</p>
                    </td>
                    <td class="px-4 py-3">
                        <p><strong>Starting:</strong> {{ leave.start_date.strftime('%d/%m/%Y') }}<br>
                            <strong>Ending:</strong> {{ leave.end_date.strftime('%d/%m/%Y') }}
                        </p>
                    </td>

                    {% if leave.status == 'approved' %}
                    <td class="px-4 py-3">
                        <p class="text-green-600">Approved</p>
                    </td>
                    {% elif leave.status == 'rejected' %}
                    <td class="px-4 py-3">
                        <p class="text-red-600">Rejected</p>
                    </td>
                    {% elif leave.status == 'pending' %}
                    <td class="px-4 py-3">
                        <p class="text-yellow-600">Pending</p>
                    </td>
                    {% endif %}

                    <td class="px-4 py-3">
                        {% if current_user.is_admin and leave.status == 'pending' %}
                        <!-- Admin actions (approve/reject) if the leave status is pending -->
                        <form method="POST" action="{{ url_for('leave.approve_leave', leave_id=leave.id) }}"
                            style="display:inline;">
                            <button type="submit" class="green_btn text-green-600 hover:underline">Approve</button>
                        </form>
                        <form method="POST" action="{{ url_for('leave.reject_leave', leave_id=leave.id) }}"
                            style="display:inline;">
                            <button type="submit" class="red_btn text-red-600 hover:underline">Reject</button>
                        </form>
                        {% elif leave.user_id == session['user_id'] %}
                        <!-- If the logged-in user is the one who booked the leave, they can edit their leave -->
                        <form method="GET" action="{{ url_for('leave.edit_leave', leave_id=leave.id) }}"
                            style="display:inline;">
                            <button type="submit" class="purple_btn hover:underline">Edit</button>
                        </form>
                        {% else %}
                        <!-- If the user is not an admin or the owner of the leave, show "No actions available" -->
                        <span class="text-gray-500">No actions available</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" class="px-4 py-3 text-center text-gray-500">No annual leave has been booked</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

</div>

{% endblock %}